@model JsoftProject.Models.NewSaleModel
@using JsoftProject.Models


@{
    ViewBag.Title = "MainView";
}

<h2>MainView</h2>
<style>
    .form-group-material {
        position: relative;
        margin-bottom: 0px !important;
    }

    body {
        position: relative;
        min-height: 100vh;
        background-image: url("/auth_template/images/alyssa-hurley-IdU1Si3wJ-I-unsplash.jpg");
    }

    .centered-div {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    footer {
        display: none;
    }

    .parent {
        position: relative;
        display: flex;
        justify-content: start;
    }

    .bottom-right {
        position: absolute;
        margin-top: 100px;
        border: 2px solid black;
        backdrop-filter: blur();
        display: inline-block;
        margin: 0 auto;
        background-color: #ffd99312;
    }
</style>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<section class="forms">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">

                        @*<form action="/NewSale/AddMorePartialView" method="post" class="text-left form-validate">*@

                        <form action="/NewSale/MainView" method="post" id="form1">
                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                            <br />

                            <div style="width: 100%;">
                                <div style="width: 45%; height: 100px; float: left;">

                                    <div class="form-group">
                                        @Html.LabelFor(model => model.trnSale.VoucherNo, htmlAttributes: new { @class = "control-label col-md-3" })

                                        <div class="col-md-10" style=" padding-left:150px; margin-top:-25px">
                                            <p>@ViewBag.VoucherNo</p>

                                        </div>
                                    </div>

                                    <div class="form-group">
                                        @Html.LabelFor(model => model.trnSale.VoucherDate, htmlAttributes: new { @class = "control-label col-md-3" })
                                        <div class="col-md-10" style=" padding-left:150px; margin-top:-25px">

                                            <p>@ViewBag.VoucherDate</p>

                                        </div>
                                    </div>
                                </div>


                                <div style="margin-left: 50%; height: 100px;">


                                    <div class="form-group right">
                                        <div class="form-group">
                                            @Html.LabelFor(model => model.trnSale.mstAccount.AccountName, htmlAttributes: new { @class = "control-label col-md-7", @style = "padding-left:160px;" })
                                            <div class="col-md-5">

                                                @Html.DropDownListFor(model => model.trnSale.AccountID, new SelectList(ViewBag.AccountList, "AccountID", "AccountName"),
                                                              htmlAttributes: new { @class = "form-control", @style = "margin-left: -161px;", id = "AccountID" })


                                                @Html.ValidationMessageFor(model => model.trnSale.AccountID, "", new { @class = "text-danger" })

                                            </div>

                                        </div>
                                        <br />
                                        <br />

                                        <div class="form-group">
                                            @Html.LabelFor(model => model.trnSale.SalesType, htmlAttributes: new { @class = "control-label col-md-7", @style = "padding-left:160px;" })
                                            <div class="col-md-5">

                                                @Html.DropDownListFor(model => model.trnSale.SalesType, new List<SelectListItem>
                                                {
                                                    new SelectListItem { Value = "SLS", Text = "Sales" },
                                                    new SelectListItem { Value = "SLSR", Text = "Sales Return" }
                                                }, "--Select--", new { @class = "form-control", @style = "margin-left: -161px;", id = "SaleType" })


                                                @Html.ValidationMessageFor(model => model.trnSale.SalesType, "", new { @class = "text-danger" })

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--<div style="justify-content:center; display:block; margin-left:35%;">-->
                                @*<a id="finished1" class="btn btn-primary float-right">Save Account Details</a>*@
                                <!--<input id="finished1" type="submit" class="btn btn-success" value="Save Account Details" />
                            </div>-->

                        </form>

                        <br />
                        <hr style="border: 1px solid red;">

                        <div style="padding-bottom: 10px;">
                            <table>
                                <tr style="font-size:16px; color:red;">
                                    <th style="padding-left:30px; padding-right:40px;">Item Name</th>
                                    <th style="padding-left:20px; padding-right:40px;">Tax</th>
                                    <th style="padding-left:70px; padding-right:40px;">Pieces</th>
                                    <th style="padding-left:90px; padding-right:40px;">Gross Weight</th>
                                    <th style="padding-left:70px; padding-right:40px;">Net Weight</th>

                                </tr>
                            </table>
                        </div>


                        <div class="parent">
                            @Html.Partial("_AddMorePartialView")
                        </div>
                        <div id="addAddMoreDiv"></div>
                        <a id="add_row" class="btn btn-primary float-right"> Add Row</a>
                        <a id="finished2" class="btn btn-danger float-right">Calculate Total</a>

                        <br />
                        <br />
                        <br />
                        <hr style="border: 1px solid red;">

                        <form action="/NewSale/AmountMethod" method="post">
                            <div class="bottom-right">
                                <br />
                                <div class="form-group" style="color:red; font-size:large">
                                    @Html.LabelFor(model => model.trnSale.TotalAmount, htmlAttributes: new { @class = "control-label col-md-2" })
                                    <div id="totalAmount" class="col-md-10" style="margin-top:9px">
                                        @Html.HiddenFor(model => model.trnSale.TotalAmount)
                                      
                                        <p id="totalAmountText"></p>
                                    </div>
                                </div>
                                <br />
                                <br />
                                <div class="form-group" style="color:blue">
                                    @Html.LabelFor(model => model.trnSale.CashAmount, htmlAttributes: new { @class = "control-label col-md-10" })
                                    <div class="col-md-10">
                                        @Html.EditorFor(model => model.trnSale.CashAmount, new { htmlAttributes = new { @class = "form-control text-right", id = "CashAmount" } })
                                        @Html.ValidationMessageFor(model => model.trnSale.CashAmount, "", new { @class = "text-danger" })
                                        <br />
                                    </div>
                                </div>

                                <div class="form-group" style="color:blue">
                                    <br />
                                    @Html.LabelFor(model => model.trnSale.ChequeAmount, htmlAttributes: new { @class = "control-label col-md-10" })
                                    <div class="col-md-10">
                                        @Html.EditorFor(model => model.trnSale.ChequeAmount, new { htmlAttributes = new { @class = "form-control text-right", id = "ChequeAmount" } })
                                        @Html.ValidationMessageFor(model => model.trnSale.ChequeAmount, "", new { @class = "text-danger" })
                                        <br />
                                    </div>
                                </div>

                                @Html.HiddenFor(model => model.trnSale.OutstandingAmount, new { id = "OutstandingAmountHidden" })

                                <div class="form-group">
                                    <br />
                                    @Html.LabelFor(model => model.trnSale.Remarks, htmlAttributes: new { @class = "control-label col-md-10" })
                                    <div class="col-md-10" style="padding-bottom:30px">
                                        @Html.EditorFor(model => model.trnSale.Remarks, new { htmlAttributes = new { @class = "form-control" } })
                                        @Html.ValidationMessageFor(model => model.trnSale.Remarks, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="form-group">
                                    <br />

                                    <div class="col-md-10" style="padding-bottom:20px; padding-left:120px;">
                                        @*<a id="finished3" class="btn btn-primary float-right">Save Amount</a>*@
                                        <input type="submit" class="btn btn-success" id="finished3" value="Save Amount" />
                                    </div>
                                </div>


                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
@section Scripts {
    <script>
      $('#add_row').on('click', function () {
        $.ajax({
            url: '@Url.Action("AddMorePartialView", "NewSale")',
            type: 'GET',
            data: {
            },
            success: function (result) {
                $('#addAddMoreDiv').append(result);
            },
            error: function () {
            }
        });
    });
    </script>

    <script>
        $(document).ready(function () {
            setInterval(function () {
                $.ajax({
                    url: '/NewSale/GetTotalAmt',
                    type: 'GET',
                    success: function (result) {
                        $('#totalAmountText').text(result); // Update the value of the p tag with the new value
                    }
                });
            }, 1000); // Refresh the value every 1 second (adjust as needed)
        });
    </script>

    <script type="text/javascript">
    $(function () {
        $('#SaleType').change(function () {
            var selectedVal = $(this).val();
            var accountId = $('#AccountID').val();
            var voucherNo = '@ViewBag.VoucherNo';
            var voucherDate = '@ViewBag.VoucherDate';
            $.ajax({
                url: '/NewSale/MainView',
                type: 'POST',
                data: {
                    trnSale: {
                        "VoucherNo": voucherNo,
                        "VoucherDate": voucherDate,
                        "AccountID": accountId,
                        "SalesType": selectedVal
                    }
                },
                success: function (result) {


                    $('#form1').off();


                    },
                error: function (err) {
                    alert("Error");
                    console.log(err);
                                    // error handling here
                    }
             });
          });
    });
    </script>
}



